(()=>{var e={452:e=>{e.exports='<svg fill="#000000" style="width:30px" version="1.1" id="Layer_1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" viewBox="0 0 476.213 476.213"><polygon points="476.213,223.107 57.427,223.107 151.82,128.713 130.607,107.5 0,238.106 130.607,368.714 151.82,347.5 57.427,253.107 476.213,253.107 "></polygon></svg>'},75:e=>{e.exports='<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 50 50"><path d="M 21 3 C 11.621094 3 4 10.621094 4 20 C 4 29.378906 11.621094 37 21 37 C 24.710938 37 28.140625 35.804688 30.9375 33.78125 L 44.09375 46.90625 L 46.90625 44.09375 L 33.90625 31.0625 C 36.460938 28.085938 38 24.222656 38 20 C 38 10.621094 30.378906 3 21 3 Z M 21 5 C 29.296875 5 36 11.703125 36 20 C 36 28.296875 29.296875 35 21 35 C 12.703125 35 6 28.296875 6 20 C 6 11.703125 12.703125 5 21 5 Z"></path></svg>'},613:e=>{e.exports='<svg viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><g fill="#141414" fill-rule="nonzero"><path d="m3.45559904 3.48107721 3.26013002 7.74280879c.20897233.4963093.20897233 1.0559187 0 1.552228l-3.26013002 7.7428088 18.83130296-8.5189228zm-.74951511-1.43663117 20.99999997 9.49999996c.3918881.1772827.3918881.7338253 0 .911108l-20.99999997 9.5c-.41424571.1873968-.8433362-.2305504-.66690162-.6495825l3.75491137-8.9179145c.10448617-.2481546.10448617-.5279594 0-.776114l-3.75491137-8.9179145c-.17643458-.41903214.25265591-.83697933.66690162-.64958246z"></path><path d="m6 12.5v-1h16.5v1z"></path></g></svg>'}},s={};function t(i){var n=s[i];if(void 0!==n)return n.exports;var a=s[i]={exports:{}};return e[i](a,a.exports,t),a.exports}t.n=e=>{var s=e&&e.__esModule?()=>e.default:()=>e;return t.d(s,{a:s}),s},t.d=(e,s)=>{for(var i in s)t.o(s,i)&&!t.o(e,i)&&Object.defineProperty(e,i,{enumerable:!0,get:s[i]})},t.g=function(){if("object"==typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"==typeof window)return window}}(),t.o=(e,s)=>Object.prototype.hasOwnProperty.call(e,s),(()=>{var e;t.g.importScripts&&(e=t.g.location+"");var s=t.g.document;if(!e&&s&&(s.currentScript&&(e=s.currentScript.src),!e)){var i=s.getElementsByTagName("script");if(i.length)for(var n=i.length-1;n>-1&&(!e||!/^http(s?):/.test(e));)e=i[n--].src}if(!e)throw new Error("Automatic publicPath is not supported in this browser");e=e.replace(/#.*$/,"").replace(/\?.*$/,"").replace(/\/[^\/]+$/,"/"),t.p=e})(),(()=>{"use strict";class e{element;constructor(e,...s){this.element=null,this.createElement(e),s&&this.appendChildren(...s)}createElement(e){const s=e.tag??"div";this.element=document.createElement(s),this.addClasses(e.classes),this.setTextContent(e.txt),this.setCallback(e.events)}addClasses(e){e?.map((e=>this.element?.classList.add(e)))}removeClass(e){this.element?.classList.remove(e)}toggleClass(e){this.element?.classList.toggle(e)}setTextContent(e=""){this.element&&(this.element.textContent=e)}setCallback(e){e?.forEach((e=>{const{callback:s,eventType:t}=e;"function"==typeof s&&t&&this.element?.addEventListener(t,s)}))}appendChildren(...s){s.filter((e=>null!==e)).forEach((s=>{if(s instanceof e){const e=s.getElement();e&&this.element?.appendChild(e)}else s instanceof HTMLElement?this.element?.appendChild(s):s instanceof SVGSVGElement&&this.element?.append(s)}))}getChildren(){return this.element?.children||[]}moveChild(s){s instanceof e&&this.element?.appendChild(s.getElement())}setAttributes(e){e.forEach((e=>{for(const[s,t]of Object.entries(e))this.element?.setAttribute(s,t)}))}getElement(){return this.element}destroyChildren(){this.element?.replaceChildren()}destroy(){this.destroyChildren(),this.element?.remove()}}class s extends e{constructor(e,s){super({tag:"button",events:[{eventType:"click",callback:s}],txt:e.txt,classes:["Doob1R6R"]}),e?.classes&&this.addClasses(e.classes)}}class i extends e{constructor(e){const{txt:s,id:t,name:i,placeholder:n,callback:a}=e;super({tag:"input",classes:["iXJnFs2Z"],events:[{eventType:"keyup",callback:e=>{a(e)}}]}),this.setAttributes([{placeholder:n},{id:t},{name:i},{value:s},{required:"true"},{autocomplete:"off"}])}clear(){this.element instanceof HTMLInputElement&&(this.element.value="")}set(e){this.element instanceof HTMLInputElement&&(this.element.value=e)}}const n="pD96lCNi",a="juKXMltl";function r(...e){return e.every((e=>!!e&&/[A-Z]/.test(e)&&e.length>4))}class o extends e{constructor(e,...s){super({tag:"div",txt:e.txt,classes:["OJLAj5_f"],events:e.events}),e.classes&&this.addClasses(e.classes),this.appendChildren(...s)}}class h extends e{password;login;loginErrorMessage;passwordErrorMessage;submitButton;gotToAboutButton;userInfo;constructor(e,t,n,h){super({tag:"form",classes:["KyYYyEXT"]}),this.userInfo=e,this.submitButton=new s({classes:["Zg8GNK1U"],txt:"Submit"},(s=>{s.preventDefault(),r(e.login,e.password||"")&&t(s)})),this.gotToAboutButton=new s({txt:"Info",id:"info"},h),this.login=new i({placeholder:"Enter the username.",id:"login",name:"login",txt:e.login,callback:s=>{n(s),r(e.login)?(this.activateButton(),this.loginErrorMessage.setTextContent("")):this.loginErrorMessage.setTextContent("Username field must contain uppercase letters and to be at least 4 characters long!")}}),this.password=new i({placeholder:"Enter the password.",id:"password",name:"password",txt:e.password||"",callback:s=>{n(s),r(e.password||"")?(this.activateButton(),this.passwordErrorMessage.setTextContent("")):this.passwordErrorMessage.setTextContent("Password field must contain uppercase letters and to be at least 4 characters long!")}}),this.loginErrorMessage=new o({}),this.passwordErrorMessage=new o({}),this.appendChildren(new o({classes:[a]},this.login,this.loginErrorMessage),new o({classes:[a]},this.password,this.passwordErrorMessage),new o({classes:["hUeSw6B4"]},this.submitButton,this.gotToAboutButton)),this.activateButton()}activateButton(){r(this.userInfo.password||"",this.userInfo.login)?this.submitButton.addClasses([n]):this.submitButton.removeClass(n)}}class d extends e{constructor(e){super({tag:"div",classes:["VUpUKK_C"],txt:e})}}class l extends e{form;errorMessage=null;constructor(e,s,t,i){super({tag:"div",classes:["QiUj9mzl"]}),this.form=new h(e,s,t,i),this.errorMessage=new d(""),this.appendChildren(this.form)}renderError(e){this.errorMessage?.setTextContent(e),this.appendChildren(this.errorMessage)}}function c(){let e="";for(let s=0;s<16;s++)e+="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789@-[]{}()+".charAt(Math.floor(71*Math.random()));return e}const g="chat_key";class u{fields;constructor(){this.fields=this.loadState(),window.addEventListener("beforeunload",this.saveState.bind(this))}getField(e){return this.fields.has(e)?this.fields.get(e):""}setField(e,s){this.fields.set(e,s)}saveState(){const e=Object.fromEntries(this.fields.entries());localStorage.setItem(g,JSON.stringify(e))}loadState(){const e=localStorage.getItem(g);if(e){const s=JSON.parse(e);return new Map(Object.entries(s))}return new Map}}class p extends e{logoutButton;userNameBlock;appNameBlock;infoButton;constructor(e,t){super({tag:"div",classes:["hUTLu0sa"]}),this.logoutButton=new s({classes:["e_jot1xl"],txt:"Logout"},e),this.userNameBlock=new o({classes:["xu8o_Hd1"]}),this.appNameBlock=new o({txt:"fun chat",classes:["BpRwEgEI"]}),this.infoButton=new s({txt:"Info"},t),this.appendChildren(this.appNameBlock,this.userNameBlock,this.logoutButton,this.infoButton)}render(e){this.userNameBlock.setTextContent(e)}}class m extends e{nav;constructor(e,s){super({tag:"div",classes:["buRw0feP"]}),this.nav=new p(e,s),this.appendChildren(this.nav)}render(e){this.nav.render(e)}}class w extends e{sender;time;constructor(){super({tag:"div",classes:["pEvrQio6"]}),this.sender=new o({}),this.time=new o({}),this.appendChildren(this.sender,this.time)}render(e,s){this.sender.setTextContent(e),this.time.setTextContent(this.formatDate(s))}formatDate(e){if(!e)throw new TypeError("datetime is not defined");const s=new Date(e);return`${s.toLocaleDateString()} ${s.toLocaleTimeString()}`}}class f extends e{status;isEdited;constructor(){super({tag:"div",classes:["wjYeLXe4"]}),this.status=new o({}),this.isEdited=new o({}),this.appendChildren(this.status,this.isEdited)}render(e,s){this.status.setTextContent(e),s&&this.isEdited.setTextContent("edited")}}class E extends e{messageDescription;messageDeliveryInfo;messageText;messageInfo;messageOptions=null;constructor(e,s){const{to:t,from:i,text:n,id:a}=e;super({tag:"div",classes:["HaJ4xodo"],events:[{eventType:"click",callback:e=>{e.stopPropagation(),s(a||"")}},{eventType:"contextmenu",callback:e=>{e.preventDefault(),e.stopPropagation(),s(a||"")}}]}),this.messageInfo=e,this.messageDescription=new w,this.messageDeliveryInfo=new f,this.messageText=new o({txt:n,tag:"div",classes:["y3HmIq5g"]}),this.setAttributes([{to:t||"",from:i||"",id:a||""}]),this.appendChildren(this.messageDescription,this.messageText,this.messageDeliveryInfo)}displayLeft(){this.addClasses(["EwVoVOd7"])}displayRight(){this.addClasses(["F1mpffDc"])}render(e,s,t,i=!1,n){this.messageDescription.render(t,n||this.messageInfo.datetime),this.messageText.setTextContent(e),this.messageDeliveryInfo.render(s,i)}removeOptions(){this.messageOptions?.destroy()}}const v="kBVEjKJD",C="DpuONGxW",M="S3awJevj";class x extends e{delete;edit;constructor(e,s){super({tag:"div",classes:["CZlddh5k"]}),this.delete=new o({tag:"div",txt:"delete",classes:[M],events:[{eventType:"click",callback:s=>e()}]}),this.edit=new o({tag:"div",txt:"edit",classes:[M],events:[{eventType:"click",callback:()=>s()}]}),this.appendChildren(this.delete,this.edit)}}class I extends e{divider;newChatMessage;user;noUserSelectedMessage;messageItems=new Map;chosenMessageId="";messageOptions;constructor(e,s,t){super({tag:"div",classes:["JHHOxrWz"],events:[{eventType:"click",callback:e=>{this.messageOptions.addClasses([C]),this.divider.destroy()}}]}),this.user=e,this.divider=new o({classes:["UVlQbqrp"],tag:"div",txt:"New messages"}),this.newChatMessage=new o({tag:"div",classes:[v]}),this.noUserSelectedMessage=new o({txt:"Please select user",tag:"div",classes:[v]}),this.messageOptions=new x((()=>{s("MSG_DELETE",{id:this.chosenMessageId})}),(()=>{t(this.chosenMessageId)})),this.appendChildren(this.noUserSelectedMessage)}createItem(e){const{to:s,status:t,datetime:i,text:n,from:a}=e,r=new E(e,this.renderOptions.bind(this));let o="";return this.user.recepient===s?(r.displayRight(),o=this.defineStatus(t)):(t?.isReaded||this.appendChildren(this.divider),r.displayLeft()),r.render(n||"",o,a||"",t?.isEdited,i),r}defineStatus(e){let s="";return e?.isDelivered&&(s="delivered"),e?.isReaded&&(s="read"),s}renderMessages(e){this.messageItems.clear(),this.destroyChildren(),e.forEach((e=>{e.id&&this.messageItems.set(e.id,this.createItem(e))})),this.appendChildren(...this.messageItems.values()),this.scroll(),this.newChatMessage.destroy(),this.noUserSelectedMessage.destroy(),this.getChildren().length||(this.newChatMessage.setTextContent(`Start chatting with ${this.user.recepient}`),this.appendChildren(this.newChatMessage))}deleteMessage(e){this.messageItems.get(e)?.destroy(),this.messageItems.delete(e)}update(e){const{id:s,text:t,status:i,from:n}=e;if(s&&t&&i&&n){const e=this.messageItems.get(s);e?.render(t,this.defineStatus(i),n,i?.isEdited)}}scroll(){const e=this.getChildren(),s=e[e.length-1];s instanceof HTMLElement&&s.scrollIntoView({behavior:"smooth",block:"end"})}renderOptions(e){this.removeOptions();const s=this.messageItems.get(e)?.getElement();this.chosenMessageId=s.id,s?.getAttribute("from")===this.user.login&&this.messageOptions.getElement()instanceof Element&&(this.messageOptions.removeClass(C),s?.appendChild(this.messageOptions.getElement()))}removeOptions(){this.messageItems.forEach((e=>e.removeOptions()))}}function y(e){return(new DOMParser).parseFromString(e,"image/svg+xml").documentElement}const b="PgFy69xU";var k=t(613),S=t.n(k);class T extends e{input;sendicon=y(S());constructor(e,s){super({tag:"div",classes:["xf4I2b85"]}),this.input=new i({placeholder:"Enter the message",name:"message",id:"message",txt:"",callback:s=>{const{target:t}=s;t instanceof HTMLInputElement&&(e(t.value),t.value?this.sendicon.classList.add(b):this.sendicon.classList.remove(b))}}),this.sendicon.classList.add("PatnUtxu"),this.sendicon.onclick=s,this.appendChildren(this.input,this.sendicon)}clearInput(){this.input.clear()}setInputValue(e){this.input.set(e)}}var U=t(452),R=t.n(U);class L extends e{closeChatButton=y(R());recepientNameBlock;statusBlock;constructor(e){super({tag:"div",classes:["g0GrzzH6"]}),this.closeChatButton.onclick=e,this.recepientNameBlock=new o({}),this.statusBlock=new o({}),this.appendChildren(this.closeChatButton,this.recepientNameBlock,this.statusBlock)}render(e,s){this.recepientNameBlock.setTextContent(e),s?this.statusBlock.setTextContent("online"):this.statusBlock.setTextContent("offline")}clear(){this.recepientNameBlock.setTextContent(""),this.statusBlock.setTextContent("")}}class O extends e{messageField;sendController;messages=new Map;chatInfo;user;constructor(e,s,t){super({tag:"div",classes:["EjjoHhbM"]}),this.user=e,this.chatInfo=new L(this.close.bind(this)),this.messageField=new I(e,s,this.turnOnEditingMode.bind(this)),this.sendController=new T(this.setMessage.bind(this),(()=>t())),this.appendChildren(this.chatInfo,this.messageField,this.sendController)}clearInput(){this.sendController.clearInput()}setMessage(e){this.user.txt=e}open(e){this.close(),this.chatInfo.render(this.user.recepient,this.user.isRecepientLogined),this.messageField.renderMessages(e),e.forEach((e=>{e.id&&this.messages.set(e.id,e)}))}close(){this.chatInfo.clear(),this.messages.clear()}addMessageItem(e){if(this.messageField.renderMessages([e]),!e.id)throw new Error("ID is not defined");this.messages.set(e.id,e)}deleteMessageItem(e){this.messageField.deleteMessage(e)}editMessageItem(e){const{id:s,text:t}=e;if(!s||!t)throw new Error("ID or text are not defined");this.messages.has(s)&&this.messageField.update(e)}read(e){const{id:s}=e;if(!s)throw new Error("ID is not defined");const t=this.messages.get(s);t&&t.status&&e.status&&(t.status.isReaded=e.status?.isReaded)}turnOnEditingMode(e){const s=this.messages.get(e);this.sendController.setInputValue(s?.text||""),this.user.isEditing=!0,this.user.msgId=e}notify(e){this.messages.has(e.id||"")&&this.messageField.update(e)}}const B={item:"UcaLYBs6",userInfoBlock:"_GkzDvgj",unread:"gTPqKBa6",hidden:"mHuZSUx0"};class P extends e{userName;statusBlock;unreadMessages;constructor(e,s){const{login:t,isLogined:i}=e;super({tag:"div",classes:[B.item],events:[{eventType:"click",callback:t=>{s(e)}}]}),this.userName=new o({tag:"div",txt:t,classes:[B.user]});const n=i?"online":"offline";this.statusBlock=new o({tag:"div",txt:n,classes:[B.status]}),this.unreadMessages=new o({tag:"div",classes:[B.unread]}),this.appendChildren(new o({classes:[B.userInfoBlock]},this.userName,this.statusBlock),this.unreadMessages)}updateItem(e){const s=e.isLogined?"online":"offline";this.statusBlock.setTextContent(s),this.userName.setTextContent(e.login)}displayUnreadMessages(e){const s=e||"";this.unreadMessages.setTextContent(s)}hide(){this.addClasses([B.hidden])}show(){this.removeClass(B.hidden)}}var _=t(75),N=t.n(_);class G extends e{input;constructor(e){super({tag:"div",classes:["ByNli4ij"]}),this.input=new i({txt:"",placeholder:"Search user",id:"searchUser",name:"search user",callback:s=>{const{target:t}=s;if(t instanceof HTMLInputElement){const{value:s}=t;e(s.toLocaleLowerCase())}}});const s=y(N());s.classList.add("tBby7qrg"),this.appendChildren(this.input,s)}}class D extends e{userItems=new Map;usersBlock;searchBlock;callback;constructor(e,s){super({tag:"div",classes:["L8VKBxa3"]}),this.callback=s,this.searchBlock=new G(this.searchUsers.bind(this)),this.usersBlock=new o({tag:"div",classes:["tzVT5OGp"]}),this.appendChildren(this.searchBlock,this.usersBlock)}renderUsers(e){e.forEach(((e,s)=>{if(this.userItems.has(s))this.userItems.get(s)?.updateItem(e);else{const t=new P(e,this.callback);this.userItems.set(s,t),this.appendChildren(t)}}))}searchUsers(e){this.userItems.forEach(((s,t)=>{t.toLocaleLowerCase().includes(e)?s.show():s.hide()}))}getItem(e){return this.userItems.get(e)}}class H extends e{userList;chat;user;usersInfo=new Map;messagesHistory=new Map;constructor(e,s,t){super({tag:"div",classes:["O6rneIGw"]}),this.user=e,this.userList=new D(e,(e=>{this.user.recepient=e.login,this.user.isRecepientLogined=e.isLogined||!1,this.openChat.bind(this)(),(this.messagesHistory.get(e.login)||[]).filter((e=>!e.status?.isReaded)).forEach((e=>{s("MSG_READ",{id:e.id})}))})),this.chat=new O(e,s,t),this.appendChildren(this.userList,this.chat)}addUsers(e){e.forEach((e=>{const{login:s}=e;this.usersInfo.has(s),this.usersInfo.set(s,e)})),this.userList.renderUsers(this.usersInfo)}defineRecepient(e){const s=(e.from===this.user.login?e.to:e.from)||"";return s||this.messagesHistory.forEach(((s,t)=>{s.forEach((s=>{if(s.id===e.id)return s.from===this.user.login?s.to:s.from}))})),s}getMessageHistory(e){const s=this.defineRecepient(e[0]);this.messagesHistory.set(s,e),this.displayUnread()}displayUnread(){this.messagesHistory.forEach(((e,s)=>{const t=e.filter((e=>!1===e.status?.isReaded&&e.to===this.user.login)).length;this.userList.getItem(s)?.displayUnreadMessages(t)}))}addMessage(e){const s=this.defineRecepient(e);this.handleHistory(s,e),s===this.user.recepient&&this.chat.addMessageItem(e),this.displayUnread()}handleHistory(e,s){this.messagesHistory.has(e)?this.messagesHistory.get(e)?.push(s):this.messagesHistory.set(e,[s])}deleteMessage(e){this.messagesHistory.forEach((s=>{const t=s.findIndex((s=>s.id===e.id));-1!==t&&s.splice(t,1)})),e.id&&this.chat.deleteMessageItem(e.id)}editMessage(e){this.messagesHistory.forEach((s=>{const t=s.findIndex((s=>s.id===e.id));if(-1!==t){let{status:i,to:n,from:a}=s[t];i&&void 0!==i.isEdited&&(i.isEdited=!0,s[t].text=e.text||""),this.chat.editMessageItem(s[t])}}))}openChat(){const e=this.messagesHistory.get(this.user.recepient)||[];console.log(e),this.chat.open(e)}read(e){this.chat.read(e),this.displayUnread()}clearInput(){this.chat.clearInput()}notify(e){this.messagesHistory.forEach((s=>{const t=s.find((s=>s.id===e.id));t&&t.status&&(t.status={...t.status,...e.status},this.chat.notify(t))}))}}class A extends e{constructor(e){const{width:s,height:t,src:i,style:n}=e;super({tag:"img"}),this.setAttributes([{src:i},{width:s},{height:t},{style:n||""}])}}const F="n31zXoiD";class V extends e{constructor(e,s,t){super({tag:"div",classes:["BXxEMFWP"]});const i=new A(e),n=new o({txt:s,classes:["SQPnqd96"]});this.appendChildren(n,i),t&&(i.setCallback([{eventType:"click",callback:t}]),i.addClasses([F]),n.setCallback([{eventType:"click",callback:t}]),n.addClasses([F]))}}const j=t.p+"24b53f4b24b1890ec5dc.png",q=t.p+"5e1ecf6ed74e2fdf4b63.jpg";var z,J;!function(e){e.GIT_HUB="https://github.com/MaksimGurbanow",e.RS_SCHOOL="https://github.com/MaksimGurbanow"}(z||(z={}));class W extends e{constructor(){super({tag:"div",classes:["nskFTW4v"]});const e=new o({classes:["iemxfR8U"]}),s=new V({src:j,width:40,height:20},"RSSchool",(()=>this.goTo(z.RS_SCHOOL))),t=new V({src:q,width:40,height:40,style:"border-radius: 50%"},"MaksimGurbanow",(()=>this.goTo(z.GIT_HUB)));e.appendChildren(s,t),this.appendChildren(e,new o({txt:"Created in 2024/18/04"}))}goTo(e){window.location.assign(e)}}class K extends e{header=null;content=null;footer=null;user;constructor(e,s,t,i){super({tag:"div",classes:["Txw6tsku"]}),this.user=e,this.header=new m((e=>s("USER_LOGOUT")),i),this.content=new H(e,s,t),this.footer=new W,this.appendChildren(this.header,this.content,this.footer)}setheaderContent(){this.header?.render(this.user.login)}addUsers(...e){this.content?.addUsers(e)}getMessageHistory(...e){this.content?.getMessageHistory(e)}addMessage(e){this.content?.addMessage(e)}deleteMessage(e){this.content?.deleteMessage(e)}editMessage(e){this.content?.editMessage(e)}read(e){this.content?.read(e)}notify(e){this.content?.notify(e)}clearInput(){this.content?.clearInput()}}class X{constructor(){this.init()}init(){addEventListener("hashchange",this.handleUrlChange.bind(this)),this.handleUrlChange()}handleUrlChange(){location.hash.slice(1)}navigateToPage(e){const s=`/${e}`;window.history.pushState({page:e},"",s)}}function Z(e){return JSON.stringify(e)}!function(e){e.LOGIN="#login",e.MENU="#menu",e.ABOUT="#about",e.RECONNECT="#reconnect"}(J||(J={}));const $=new class{constructor(){}login(e){ee.send(Z({id:e.id,type:"USER_LOGIN",payload:{user:{login:e.login,password:e.password}}}))}logout(e){ee.send(Z({id:e.id,type:"USER_LOGOUT",payload:{user:{login:e.login,password:e.password}}}))}getActiveUsers(e){ee.send(Z({id:e||"",type:"USER_ACTIVE",payload:null}))}getInactiveUsers(e){ee.send(Z({id:e||"",type:"USER_INACTIVE",payload:null}))}getMessageHistory(e,s){ee.send(Z({id:e||"",type:"MSG_FROM_USER",payload:{user:{login:s||""}}}))}sendMessage(e,s,t){ee.send(Z({id:e,type:"MSG_SEND",payload:{message:{to:s,text:t}}}))}deleteMessage(e,s){e&&s&&ee.send(Z({id:e,type:"MSG_DELETE",payload:{message:{id:s}}}))}sendReadStatusChange(e,s){e&&s&&ee.send(Z({id:e,type:"MSG_READ",payload:{message:{id:s}}}))}editMessage(e,s,t){ee.send(Z({id:e||"",type:"MSG_EDIT",payload:{message:{id:s,text:t}}}))}sendRequest(e,s,t){switch(e){case"USER_LOGIN":this.login(s);break;case"USER_LOGOUT":this.logout(s);break;case"USER_ACTIVE":this.getActiveUsers(s.id);break;case"USER_INACTIVE":this.getInactiveUsers(s.id);break;case"MSG_SEND":t&&this.sendMessage(s.id||"",t.to||"",t.text||"");break;case"MSG_FROM_USER":this.getMessageHistory(s.id,s.login);break;case"MSG_DELIVER":case"MSG_READ":this.sendReadStatusChange(s.id,t?.id);break;case"MSG_DELETE":this.deleteMessage(s.id,t?.id);break;case"MSG_EDIT":this.editMessage(s.id,t?.id,t?.text)}}};class Q extends e{constructor(e,t,i){super({tag:"div",classes:["Ajhrkgno"]});const n=new o({tag:"div",txt:e}),a=new s({txt:t},i);this.appendChildren(n,a)}}function Y(){return new WebSocket("ws://localhost:4000")}let ee=Y();(new class{loginPage;menuPage;infoPage;recconectPage;user;router;rootElem=null;state=new u;currentPage=J.LOGIN;constructor(){this.router=new X,this.initWebSocketListener(),this.initWindowListener(),this.user={login:this.state.getField("login")||"",password:this.state.getField("password")||"",id:c(),recepient:"",isEditing:!1,msgId:"",islogined:!1,isRecepientLogined:!1},this.loginPage=new l(this.user,(e=>this.sendRequest.bind(this)("USER_LOGIN")),this.handleChange.bind(this),(e=>this.switchPage.bind(this)(J.ABOUT))),this.menuPage=new K(this.user,this.sendRequest.bind(this),this.sendMessage.bind(this),(e=>this.switchPage.bind(this)(J.ABOUT))),this.infoPage=new Q("The application was develope\n      as part of the course the RSSchool JS/FE\n     2023Q3 course","Info",(e=>{this.user.islogined?this.switchPage(J.MENU):this.switchPage(J.LOGIN)})),this.recconectPage=new Q("Oops... Disconnection occured. would you like to try to reconnect?","Reconnect",(e=>{ee=Y(),ee.onopen=()=>{this.sendRequest("USER_LOGIN"),this.initWebSocketListener()}}))}initWindowListener(){window.addEventListener("keyup",(e=>{if("Enter"===e.key&&r(this.user.login,this.user.password||""))switch(this.currentPage){case J.LOGIN:this.sendRequest("USER_LOGIN");break;case J.MENU:this.sendMessage();break;default:throw new Error("PageError: unknown page")}}))}init(){this.rootElem=document.createElement("div"),this.rootElem.id="root",document.body.append(this.rootElem),this.router.navigateToPage(J.LOGIN),this.renderPage(this.loginPage)}renderPage(e){this.rootElem?.replaceChildren(),e&&this.rootElem?.appendChild(e.getElement())}handleChange(e){const{target:s}=e;if(s instanceof HTMLInputElement){const{name:e,value:t}=s;["login","password"].includes(e)&&(this.user[e]=t,this.state.setField(e,t))}}sendMessage(){this.user.recepient&&this.user.txt&&(this.user.isEditing?this.sendRequest("MSG_EDIT",{id:this.user.msgId,text:this.user.txt}):this.sendRequest("MSG_SEND",{to:this.user.recepient,text:this.user.txt}),this.menuPage.clearInput(),this.user.isEditing=!1,this.user.txt="",this.user.msgId="")}switchPage(e){switch(e){case J.MENU:this.renderPage(this.menuPage);break;case J.LOGIN:this.renderPage(this.loginPage);break;case J.ABOUT:this.renderPage(this.infoPage);break;case J.RECONNECT:this.renderPage(this.recconectPage)}this.router.navigateToPage(e),this.currentPage=e}initWebSocketListener(){ee.onmessage=e=>{const s=function(e=""){return JSON.parse(e)}(e.data);if(s){const{id:e,type:t,payload:i}=s;switch(t){case"USER_LOGIN":this.menuPage.setheaderContent(),this.user.islogined=!0,this.switchPage(J.MENU),this.sendRequest("USER_ACTIVE"),this.sendRequest("USER_INACTIVE");break;case"USER_LOGOUT":this.switchPage(J.LOGIN),this.user.islogined=!1;break;case"ERROR":const t=function(e=""){return e.charAt(0).toUpperCase()+e.slice(1)+"!"}(i?.error);this.loginPage.renderError(t);break;case"USER_EXTERNAL_LOGIN":const n=i?.user;n&&this.menuPage.addUsers(n);break;case"USER_EXTERNAL_LOGOUT":const a=i?.user;a&&this.menuPage.addUsers(a);break;case"USER_ACTIVE":if(i?.users){const s=i.users.filter((e=>e.login!==this.user.login));this.menuPage.addUsers(...s),s.forEach((s=>{$.sendRequest("MSG_FROM_USER",{id:e||"",login:s.login})}))}break;case"USER_INACTIVE":if(s.payload?.users){const{users:t}=s.payload;this.menuPage.addUsers(...t),t.forEach((s=>{$.sendRequest("MSG_FROM_USER",{id:e||"",login:s.login})}))}break;case"MSG_SEND":if(!i?.message)throw new Error("Message payload is empty");this.menuPage.addMessage(i.message);break;case"MSG_FROM_USER":const r=i?.messages||[];r.length&&this.menuPage.getMessageHistory(...r);break;case"MSG_DELIVER":i?.message&&this.menuPage.notify(i?.message);break;case"MSG_READ":if(!i?.message)throw new TypeError("Message info is empty");null===e&&(this.menuPage.getMessageHistory(i.message),this.menuPage.notify(i.message)),this.menuPage.read(i?.message);break;case"MSG_DELETE":i?.message&&this.menuPage.deleteMessage(i?.message);break;case"MSG_EDIT":i?.message&&this.menuPage.editMessage(i?.message)}}},ee.onclose=e=>{this.switchPage(J.RECONNECT)}}sendRequest(e,s){$.sendRequest(e,this.user,s)}}).init()})()})();